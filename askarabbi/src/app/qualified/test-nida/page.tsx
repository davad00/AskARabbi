"use client";

import React from 'react';
import Image from "next/image";
import logo from "../../../../public/logo.png"; // Adjusted path assuming /qualified/test-nida/
import { useRouter } from 'next/navigation';

// Content for Nida Test
const testContent = `בס"ד

# הרבנות הראשית לישראל
## THE CHIEF RABBINATE OF ISRAEL
### מחלקת הבחינות הארצית

כ"ח אדר, תשס"ט

## מבחן בהלכות נידה

---

## עיון

1) מהם התנאים או הנתונים הנצרכים בכדי שאשה תהיה טמאה מן התורה? ששה במספר!
2) דם קישוי –
   א. מהו דם קישוי? ומתי הוא טמא מן התורה?
   ב. האם שייכת חומרת רבי זירא בדם קישוי ליישב עליו שבעה נקיים? (שיטות הראשונים).
   ג. מהם הטעמים (המוזכרים בראשונים) להחמיר לישב עליו ז' נקיים?
3) נאמנות האשה בענייני נדה
   א. מהו המקור לנאמנותה (מהיכן לומדים)?
   ב. האם ענייני נדה הם דברים שבערוה או לא, ומה הנפקא מינה?
   ג. הבא ג' אופנים בהן אין האשה נאמנת?
4) אמרה טמאה אני וחזרה ואמרה טהורה אני ונתנה אמתלא טובה לדבריה נאמנת -
   א. האם פירוש הדבר שמאמינים לדבריה האחרונים יותר מן הראשונים, ואם כן מדוע?
   ב. האם כשאומרת מקודשת אני וחזרה ואמרה פנויה אני ונתנה אמתלא לדבריה, האם הדין שווה למקרה א', ואם לא מדוע?
5) בדיקה לבעלה לפני תשמיש ולאחריו – כשאין לה וסת קבוע -
   א. מה הדעות שהובאו בגמ'?
   ב. מהן שיטות הראשונים, וכיצד נפסק להלכה?
   ג. מהי שיטת הריי"ף, ומה הקשו עליו, וכיצד ניתן לתרץ?
6) תלויה במכה –
   א. האם בזה"ז תולין במכה, ואם כן מדוע לא התירו דם בתולים?
   ב. האם תולין במכה שלא ידוע שמוציאה דם?
   ג. האם תולין במכה שנמצאת במקור?
7) בית הסתרים לענין טבילה וחציצה –
   א. מהן שיטות הראשונים לענין ביאת מים?
   ב. האם דין זה מהתורה או מדרבנן?
   ג. האם יש חילוק בין אשה לאשה?
8) מינקת -
   א. מניקה שכלו ימי הנקתה למה עליה לחשוש?
   ב. האם יש חילוק אם היה לה לפני עיבורה וסת קבוע או לא?
9) וסת הגוף ווסת אונס –
   א. מהו וסת הגוף ומהו וסת אונס?
   ב. מה השווה והשוני ביניהם?
   ג. אכלה מאכלים חריפים ג'יפ וראתה, האם דינו כווסת אונס או כווסת הגוף?
10) פתיחת הקבר עם או בלי דם –
    א. מהן הדעות המופיעות בתלמוד?
    ב. מהן הדעות בראשונים, וכיצד נפסק להלכה?
    ג. האם יש הבדל בין פתיחת הקבר מבפנים או מבחוץ?

---

## בקיאות

1) מהו דם צדדים, והאם יש לישב עליו ז' נקיים?
2) הסבר מהו "לול" ומה "עליה", ומה נאמר על כך בגמ' (הדעות השונות)?
3) האם "הרגשה" סימן או סיבה לטומאה- מהן הדעות בראשונים ובאחרונים?
4) חיבוק ונישוק סמוך לוסת – מותר או אסור. ואם אסור- האם מהתורה או מדרבנן?
5) מהו המקור לכך שבלנית צריכה להיות נוכחת בשעת הטבילה? והאם זה מעכב?
6) רודמ\"ת משום חולי או משום וסת, ומה הנפקא מינה? (הבא לפחות ג\' נ\"מ)?
7) רודמ\"ת- האם ראיה ראשונה מן המנין, מהן הדעות, וכיצד נפסק להלכה?
8) א. מהו המקור שממנו נלמד טבילה לנדה? ב. האם טבילת נדה מהתורה או מדרבנן?
9) מה הדין בראיית דמים:
   א. בלילה
   ב. לאור הכוכבים
10) טבילה וחציצה
    א. האם עליה לגלח שערה, ואם כן איזה שיער?
    ב. אם לא גילחה, האם זה מעכב בטבילה, וצריכה לחזור ולטבול?
    
---

---

בית יהב, ירמיהו 80, ירושלים, ת.ד. 36016, מיקוד 91360, טל': 02-5313143/4, פקס: 02-5000353
Beit Yahav, 80 Yirmiyahu St., Jerusalem P.O.B. 36016 Tel.: 02-5313143/4, Fax: 02-5000353
`;

interface AnswerData {
  paragraphs: string[];
  sources?: string;
}
interface ExpectedAnswerMapStructure {
    subAnswers: AnswerData[];
}
// Data for answers - initially empty for Nida test
const answersMap: Record<string, ExpectedAnswerMapStructure> = {
  "מהם התנאים או הנתונים הנצרכים בכדי שאשה תהיה טמאה מן התורה? ששה במספר!": {
    subAnswers: [
      {
        paragraphs: [
          "לסיכום",
          "**על מנת שאישה תיטמא מן התורה בראיית דם, נדרשים להתקיים שישה תנאים עיקריים:**",
          "1.  **גיל האישה:** מעל גיל שלוש שנים ויום אחד.",
          "2.  **מקור הדם:** מהרחם.",
          "3.  **צבע הדם:** אחד מהצבעים המטמאים.",
          "4.  **הרגשת יציאת הדם:** הרגשה בגופה בעת יציאת הדם.",
          "5.  **יציאת הדם אל מחוץ לגוף:** הדם צריך להיראות מחוץ למקור.",
          "6.  **שלא יהיה דם מחמת מכה:** הדם צריך להיות דם טבעי ולא כתוצאה מפציעה."
        ],
        sources: "*   תנ\"ך: ויקרא פרקים י\"ב, ט\"ו.\\n*   תלמוד בבלי: מסכת נידה (דפים ב' ע\"א, י\"ט ע\"א, כ' ע\"ב, מ\"א ע\"א, מ\"ה ע\"א, נ\"ז ע\"ב).\\n*   שולחן ערוך: יורה דעה, סימנים קפ\"ג, קפ\"ז, קפ\"ח, קפ\"ט.\\n*   פוסקים: רמב\"ם (הלכות איסורי ביאה), ראב\"ד.\\n*   אתרים: הידברות, ישיבה, דעת."
      }
    ]
  },
  "דם קישוי –": {
    subAnswers: [
      {
        paragraphs: [
          "דם קישוי הוא דם היוצא מהאישה בזמן צירים וקשיי לידה, לפני יציאת הוולד.",
          "מן התורה, דם זה יכול להיות טמא בכמה אופנים:",
          "1.  **כדם לידה:** אם לאחר ראיית הדם האישה ילדה (ולד חי או מת), הדם נחשב חלק מטומאת הלידה (לאחר יציאת רוב הוולד).",
          "2.  **כדם נידה:** אם הדם נראה בימי נידותה הרגילים, והקישוי פסק והיא לא ילדה מיד.",
          "3.  **כדם זיבה:** אם הדם נראה שלא בימי נידותה (בימי זיבה), והקישוי פסק והיא לא ילדה מיד, וראתה שלושה ימים רצופים. אם ראתה יום או יומיים, דינה כשומרת יום כנגד יום מן התורה."
        ],
        sources: "*   תנ\"ך: ויקרא י\"ב, ב'-ה'; ויקרא ט\"ו, כ\"ה-כ\"ח.\\n*   תלמוד: מסכת נדה, דף ל\"ה ע\"ב - ל\"ו ע\"ב.\\n*   רש\"י: על נדה ל\"ה ע\"ב, ד\"ה המקשה.\\n*   רמב\"ם: הלכות איסורי ביאה, פרק ה', הלכות ז'-ח'.\\n*   שולחן ערוך: יורה דעה, סימן קצ\"ד, סעיפים י'-י\"א."
      },
      {
        paragraphs: [
          "חומרת רבי זירא קובעת שעל כל טיפת דם יש לספור שבעה נקיים.",
          "לגבי החלת חומרה זו על דם קישוי (שפסק ולא ילדה מיד):",
          "*   **הרמב\"ם** פוסק שיש להחשיבה כספק זבה ולדרוש שבעה נקיים אם הדם נראה בימי זיבה.",
          "*   **הרמב\"ן והרא\"ש** סוברים במפורש שחומרת בנות ישראל חלה גם על דם קישוי, ולכן יש לספור שבעה נקיים.",
          "*   **בעל המאור** נטה להקל יותר, וסבר שחומרת רבי זירא לא נאמרה על דם קישוי באופן גורף, ואם ראתה רק יום או יומיים, דינה כשומרת יום כנגד יום.",
          "*   **להלכה**, השולחן ערוך פוסק שיש צורך בשבעה נקיים אם הדם נראה בימי זיבה. הרמ\"א מחמיר עוד יותר וקובע שנהגו לדרוש שבעה נקיים על כל דם קישוי שפסק, בין בימי נידה ובין בימי זיבה, ואפילו אם ראתה רק יום אחד. זוהי ההלכה המקובלת כיום ברוב קהילות ישראל."
        ],
        sources: "*   תלמוד: מסכת נדה, דף ס\"ו ע\"א.\\n*   רמב\"ם: הלכות איסורי ביאה, פרק ה', הלכה ח'; פרק י\"א, הלכה ט\"ז.\\n*   ראב\"ד: השגות על הרמב\"ם, הלכות איסורי ביאה, פרק ה', הלכה ח'.\\n*   רמב\"ן: הלכות נדה, פרק ד' (או חידושים לנדה ל\"ו ע\"ב).\\n*   רא\"ש: נדה, פרק ד', סימן ג'.\\n*   בעל המאור: על הרי\"ף, נדה דף י\"ד ע\"ב (בדפי הרי\"ף).\\n*   שולחן ערוך ורמ\"א: יורה דעה, סימן קצ\"ד, סעיף י\"א."
      },
      {
        paragraphs: [
          "הטעמים המרכזיים להחמיר בדם קישוי (שפסק ולא ילדה מיד) ולדרוש עליו שבעה נקיים הם:",
          "1.  **חשש לזיבות מן התורה:** כאשר הדם נראה בימי זיבה, יש חשש שמא היא זבה או ספק זבה, מה שמצריך שבעה נקיים.",
          "2.  **החלת חומרת רבי זירא:** רוב הפוסקים סוברים שחומרת בנות ישראל, להחמיר על כל טיפת דם ולספור שבעה נקיים, חלה גם על דם קישוי שפסק. טעמי חומרה זו כוללים מניעת טעויות, הרחקה מן העבירה, וקושי בהבחנה בין דמים.",
          "3.  **אופי לא ודאי של הדם:** דם קישוי הוא בעל אופי לא ודאי, מה שמצדיק גישה מחמירה."
        ],
        sources: "*   רמב\"ם: הלכות איסורי ביאה, פרק ה', הלכה ח'.\\n*   רמב\"ן: חידושים למסכת נדה, דף ל\"ו ע\"ב.\\n*   רא\"ש: מסכת נדה, פרק ד', סימן ג'.\\n*   פוסקים כלליים על חומרת רבי זירא: (למשל, בית יוסף, יורה דעה, סימן קפ\"ג)."
      }
    ]
  },
  "נאמנות האשה בענייני נדה": {
    subAnswers: [
      {
        paragraphs: [
          "מקור נאמנותה של האישה בענייני נידה הוא מהתורה, מהפסוק \"וספרה לה\" (ויקרא טו, כח), ממנו למדו חז\"ל שהתורה סמכה עליה בעניינים אלו. הגמרא, הראשונים והשולחן ערוך פסקו הלכה למעשה על פי יסוד זה."
        ],
        sources: "ויקרא טו, כח; תלמוד בבלי, מסכת כתובות דף עב, עמוד א; רמב\"ם, הלכות איסורי ביאה, פרק ד, הלכה כו; רא\"ש, כתובות, פרק ז, סימן ה; שולחן ערוך, יורה דעה, סימן קפה, סעיף א."
      },
      {
        paragraphs: [
          "איסור נידה הוא חמור וקשור לענייני ערווה. עם זאת, לעניין נאמנות האישה על טהרתה, התורה האמינה לה, ולכן אין זה נחשב \"דבר שבערווה\" במובן הדורש שני עדים. הנפקא מינה העיקרית היא שהאישה נאמנת בעדותה על עצמה, ואין צורך בשני עדים כדי לאשר את טהרתה."
        ],
        sources: "ויקרא יח, יט; תלמוד בבלי, מסכת גיטין דף פא, עמוד א; רש\"י שם; ש\"ך על שולחן ערוך, יורה דעה, סימן קפה, ס\"ק א."
      },
      {
        paragraphs: [
          "שלושה אופנים עיקריים בהם האישה אינה נאמנת על טהרתה הם:",
          "1.  כאשר יש עדים כשרים המעידים שטמאה ולא טבלה.",
          "2.  כאשר הוחזקה כנידה בעיני שכנותיה (כגון שעבר זמנה לטבול ולא טבלה, או שאמרה בפניהן שהיא טמאה ולאחר מכן טוענת שטבלה באופן המעורר חשד).",
          "3.  כאשר היא חשודה ומפורסמת כמי שמזלזלת בדיני טהרה או שאינה בקיאה בהם ואינה משתדלת לתקן זאת."
        ],
        sources: "תלמוד בבלי, מסכת כתובות דף עב, עמוד א; תלמוד בבלי, מסכת נדרים דף צ, עמוד ב; רמב\"ם, הלכות איסורי ביאה, פרק ד הלכה כז, ופרק יא הלכה יט; שולחן ערוך, יורה דעה, סימן קפה, סעיפים א, י."
      }
    ]
  },
  "אמרה טמאה אני וחזרה ואמרה טהורה אני ונתנה אמתלא טובה לדבריה נאמנת -": {
    subAnswers: [
      {
        paragraphs: [
          "מאמינים לדבריה האחרונים של האישה שאמרה \"טהורה אני\" לאחר שאמרה \"טמאה אני\", בתנאי שנתנה אמתלא טובה לדבריה. הסיבה העיקרית לכך היא הכלל \"הפה שאסר הוא הפה שהתיר\", והאמתלא מספקת הסבר מניח את הדעת לשינוי בדבריה, כך שאין מניחים שהיא משקרת."
        ],
        sources: "*   **מקורות עיקריים:** תלמוד בבלי, מסכת כתובות דף כב, ע\"א-ע\"ב; רמב\"ם, הלכות איסורי ביאה פרק ד הלכה יד; שולחן ערוך, יורה דעה סימן קפה, סעיף ג."
      },
      {
        paragraphs: [
          "הדין במקרה של אישה שאמרה \"מקודשת אני\" וחזרה בה ואמרה \"פנויה אני\" עם אמתלא, **אינו זהה** למקרה של \"טמאה אני\". לפי פסיקת השולחן ערוך, אם אמרה \"מקודשת אני\" (אפילו שלא בפני עדים כשרים), היא אינה נאמנת לחזור בה גם עם אמתלא, מחמת חומרת איסור אשת איש והחשש שעיניה נתנה באחר. עם זאת, יש דעות מקילות (הראב\"ד, והובאו ברמ\"א) שבמקרה כזה, אם אין עדים כשרים ונתנה אמתלא טובה, היא נאמנת. לכתחילה נוהגים להחמיר, אך בשעת הדחק יש מקום לשקול את הדעה המקילה."
        ],
        sources: "*   **מקורות עיקריים:** תלמוד בבלי, מסכת כתובות דף כב, ע\"א-ע\"ב; רמב\"ם, הלכות גירושין פרק י הלכה יט; שולחן ערוך, אבן העזר סימן מז, סעיף ב, והגהת הרמ\"א שם."
      }
    ]
  },
  "בדיקה לבעלה לפני תשמיש ולאחריו – כשאין לה וסת קבוע -": {
    subAnswers: [
      {
        paragraphs: [
          "הגמרא מביאה דעות שונות לגבי חובת הבדיקות לפני ואחרי תשמיש, במיוחד לאישה שאין לה וסת קבוע. ישנה דעה המחייבת שתי בדיקות באופן כללי, דעה המבחינה בין אישה שאין לה וסת קבוע כלל (שצריכה שתיים) לזו שיש לה וסת קבוע לפרקים (שצריכה אחת לפני), ודעה המחמירה שגם מי שיש לה וסת קבוע לפרקים צריכה שתי בדיקות. כמו כן, הגמרא דנה באופן ביצוע הבדיקה."
        ],
        sources: "*   תנ\"ך: ויקרא פרק יח, פסוק יט; ויקרא פרק טו, פסוק כה.\\n*   תלמוד בבלי: מסכת נידה, דף יא עמוד ב; דף יב עמוד א."
      },
      {
        paragraphs: [
          "הראשונים נחלקו בשאלה האם לפסוק כדעה המקלה (כרב פפא) או המחמירה (כרב הונא בריה דרב יהושע) לגבי אישה שיש לה וסת קבוע לפרקים. הרמב\"ם, הרא\"ש והרי\"ף פסקו להחמיר. השולחן ערוך פסק כמותם, שאישה שאין לה וסת קבוע, או שיש לה וסת קבוע לפרקים, צריכה שתי בדיקות (לפני ואחרי תשמיש). הרמ\"א הוסיף שנהגו להחמיר שגם אישה עם וסת קבוע תבדוק לפני תשמיש, אך הביא הקלות בדיעבד."
        ],
        sources: "*   תנ\"ך: (כנ\"ל)\\n*   תלמוד בבלי: מסכת נידה, דף יב עמוד א.\\n*   ראשונים: רש\"י (נידה יב ע\"א); תוספות (נידה יב ע\"א); רמב\"ם (הלכות איסורי ביאה, פרק ד, הלכות יג-יד); רא\"ש (נידה, פרק א, סימן כג); רי\"ף (נידה ד ע\"ב בדפיו); רשב\"א (תורת הבית, בית ז, שער ה).\\n*   פוסקים: שולחן ערוך (יורה דעה, סימן קפ\"ו, סעיף א); רמ\"א (שם).\\n*   אתרים: הידברות (hidabroot.org  )."
      },
      {
        paragraphs: [
          "שיטת הרי\"ף היא לפסוק כרב הונא בריה דרב יהושע, שגם אישה שיש לה וסת קבוע לפרקים צריכה שתי בדיקות, לפני ואחרי תשמיש. הקושי המרכזי על שיטתו הוא מדוע לא התחשב בדברי רב אשי שנראים כמסייגים את רב הונא בריה דרב יהושע. התירוצים מתמקדים בכך שדברי רב אשי אינם דחייה מוחלטת של ההלכה, או שהלכה נפסקה כרב הונא בריה דרב יהושע מכוח היותו \"בתרא\", או שהרי\"ף סבר שאין הלכה כרב אשי בנקודה זו."
        ],
        sources: "*   תנ\"ך: (כנ\"ל)\\n*   תלמוד בבלי: מסכת נידה, דף יא עמוד ב; דף יב עמוד א.\\n*   ראשונים: רי\"ף (נידה ד ע\"ב בדפיו); רשב\"א (תורת הבית, בית ז, שער ה); רא\"ש (נידה, פרק א, סימן כג); מאירי (בית הבחירה, נידה יב ע\"א).\\n*   פוסקים: בית יוסף (יורה דעה, סימן קפ\"ו).\\n*   אתרים: ספריא (sefaria.org  .il)."
      }
    ]
  },
  "תלויה במכה –": {
    subAnswers: [
      {
        paragraphs: [
          "בזמן הזה תולים במכה שיכולה להוציא דם, והאישה נשארת טהורה. דם בתולים, לעומת זאת, טמא מדרבנן, וזאת בשל גזירת חכמים מיוחדת שמטרתה למנוע זלזול בדיני נידה או משום שהוא נחשב \"דם חימוד\"."
        ],
        sources: "*   תנ\"ך: ויקרא ט\"ו, י\"ט.\\n*   תלמוד: מסכת נידה דף ס\"ו, עמוד א'; מסכת נידה דף ס\"ה, עמוד ב' – ס\"ו, עמוד א'.\\n*   ראשונים: רמב\"ם, הלכות איסורי ביאה, פרק ד', הלכה י\"ג; פרק ה', הלכה י\"ח. תוספות, נידה ס\"ה ע\"ב, ד\"ה \"דם\".\\n*   שולחן ערוך: יורה דעה, סימן קפ\"ז, סעיף ד'; סימן קצ\"ג, סעיף א'.\\n*   אחרונים ומודרניים: הרב עובדיה יוסף, טהרת הבית, חלק ב', עמוד רצ\"ט."
      },
      {
        paragraphs: [
          "אין תולים במכה שלא ידוע שהיא מוציאה דם, או במכה שטחית מאוד שאין דרכה להוציא דם. תולים רק במכה שיש סבירות שהיא יכולה להיות מקור הדימום."
        ],
        sources: "*   תלמוד: מסכת נידה דף ס\"ו, עמוד א'.\\n*   ראשונים: רמב\"ם, הלכות איסורי ביאה, פרק ה', הלכה י\"ח.\\n*   שולחן ערוך: יורה דעה, סימן קפ\"ז, סעיפים ד'-ה'.\\n*   אחרונים: ש\"ך, יורה דעה, סימן קפ\"ז, ס\"ק י\"ג; ט\"ז, שם, ס\"ק ז'."
      },
      {
        paragraphs: [
          "אם המכה נמצאת ב\"מקור\" עצמו (הרחם), אין תולים בה את הדם, והדם טמא כדין נידה. אם המכה נמצאת ב\"פרוזדור\" (הנרתיק) או ב\"בית החיצון\", תולים בה את הדם, והאישה טהורה. האבחנה המדויקת של מיקום המכה היא קריטית, ולעיתים נדרשת התייעצות רפואית."
        ],
        sources: "*   תנ\"ך: ויקרא ט\"ו, י\"ט.\\n*   תלמוד: מסכת נידה דף ס\"ו, עמוד א'.\\n*   ראשונים: רמב\"ם, הלכות איסורי ביאה, פרק ה', הלכה ט\"ז.\\n*   שולחן ערוך: יורה דעה, סימן קפ\"ז, סעיף ו'.\\n*   אחרונים ומודרניים: נודע ביהודה, מהדורה קמא, יורה דעה, סימן נ\"ה; חתם סופר, יורה דעה, סימן קע\"ב; אגרות משה, יורה דעה, חלק ב', סימן ע\"א."
      }
    ]
  },
  "בית הסתרים לענין טבילה וחציצה –": {
    subAnswers: [
      {
        paragraphs: [
          "שיטות הראשונים נחלקות בשאלה האם בית הסתרים צריך ביאת מים בפועל (או לפחות להיות ראוי לביאת מים). רש\"י מקל יותר וסובר שאין צורך בביאת מים למקום שאין דרך מים להגיע אליו, אלא אם יש שם חציצה שהאדם מקפיד עליה. לעומתו, תוספות, הרא\"ש והרמב\"ם (במשתמע) מחמירים יותר וסוברים שכל הגוף, כולל בית הסתרים, צריך לבוא במגע עם המים או להיות ראוי לכך. ההלכה נפסקה כדעה המחמירה."
        ],
        sources: "*   **מקורות עיקריים:** ויקרא טו, טז; גמרא נידה סו ע\"ב; רש\"י ותוספות על נידה סו ע\"ב; רמב\"ם, הלכות מקוואות, פרק א', הלכה ז'; רא\"ש, נידה, פרק י', סימן ב'; שולחן ערוך, יורה דעה, סימן קצ\"ח, סעיפים א', ו'."
      },
      {
        paragraphs: [
          "ישנה מחלוקת פוסקים האם חציצה בבית הסתרים פוסלת מהתורה או מדרבנן. הדעה המקובלת להלכה היא שחציצה בבית הסתרים, כמו בשאר הגוף, פוסלת את הטבילה מהתורה, מכוח הפסוק \"ורחץ את כל בשרו\". לכן, יש להקפיד על כך מאוד."
        ],
        sources: "*   **מקורות עיקריים:** ויקרא טו, טז; רמב\"ם, הלכות מקוואות, פרק א', הלכה ז'; ראב\"ד שם; שולחן ערוך, יורה דעה, סימן קצ\"ח, סעיפים א', ד'; ט\"ז שם, ס\"ק א'; שו\"ת יביע אומר (מובא בטהרת הבית)."
      },
      {
        paragraphs: [
          "באופן עקרוני, דיני בית הסתרים וחציצה בטבילה שווים לכל הנשים. החובה היא שכל הגוף יבוא במגע עם המים ללא חציצה. ייתכנו הבדלים מעשיים הנובעים מהקפדה אישית (אם כי להלכה מחמירים שכל חציצה פוסלת), או ממצבים פיזיים ורפואיים ספציפיים, המצריכים התייעצות פרטנית עם פוסק הלכה."
        ],
        sources: "*   **מקורות עיקריים:** ויקרא טו, טז; שולחן ערוך, יורה דעה, סימן קצ\"ח, סעיפים א', ו'; רמ\"א שם."
      }
    ]
  },
  "מינקת -": {
    subAnswers: [
      {
        paragraphs: [
          "מינקת שכלו ימי הנקתה צריכה לחשוש בעיקר לחזרת הווסת הסדירה שלה. משום כך, עליה להיות ערה לסימנים גופניים, לקיים בדיקות כנדרש בימים החשודים (עונה בינונית, יום החודש, והפלגה אם תהיה), ולפרוש מבעלה בעונות אלו, כדי שלא תיכשל באיסור נידה."
        ],
        sources: "*   **מקורות עיקריים:** ויקרא י\"ח, יט; תלמוד בבלי, מסכת נידה; שולחן ערוך, יורה דעה, סימן קפ\"ד, סעיף ז'; טהרת הבית (הרב עובדיה יוסף); דרכי טהרה (הרב מרדכי אליהו)."
      },
      {
        paragraphs: [
          "קיים חילוק הלכתי משמעותי. אם לאישה היה וסת קבוע לפני ההיריון, היא צריכה לחזור ולחשוש לווסת זה (בנוסף לחששות לווסתות שאינן קבועות עד לקביעתו מחדש) כאשר היא חוזרת לראות דם לאחר ההנקה. אם לא היה לה וסת קבוע, היא חוששת לווסתות שאינן קבועות (עונה בינונית, יום החודש, והפלגה אם תהיה) עד שתקבע וסת חדש על פי ההלכה."
        ],
        sources: "*   **מקורות עיקריים:** תלמוד בבלי, מסכת נידה דף ט' ע\"ב; שולחן ערוך, יורה דעה, סימן קפ\"ט, סעיפים א'-ב', י\"ג; טהרת הבית (הרב עובדיה יוסף); שערי טהרה (הרב יחזקאל פאנעט)."
      }
    ]
  },
  "וסת הגוף ווסת אונס –": {
    subAnswers: [
      {
        paragraphs: [
          "וסת הגוף הוא ראיית דם הנובעת מתהליכים פנימיים וטבעיים של האישה, ללא גורם חיצוני ידוע. וסת אונס (או וסת התלוי בדבר) הוא ראיית דם הנגרמת כתוצאה מגורם חיצוני או אירוע חריג, כגון קפיצה, פחד, או אכילת מאכלים מסוימים."
        ],
        sources: "*   **מקורות עיקריים:** ויקרא ט\"ו, יט; תלמוד בבלי, מסכת נידה, דף סג ע\"ב; שולחן ערוך, יורה דעה, סימן קפ\"ט, סעיף י\"ג."
      },
      {
        paragraphs: [
          "השווה בין וסת הגוף לווסת אונס הוא ששניהם יכולים לגרום לאישה להיטמא אם ראתה דם אוסר. השוני המרכזי הוא שווסת הגוף יכול לקבוע וסת קבוע המחייב פרישה עתידית, בעוד שווסת אונס בדרך כלל אינו קובע וסת ואינו מחייב פרישה עתידית (אלא אם כן האונס עצמו הופך לדבר קבוע הגורם לראייה)."
        ],
        sources: "*   **מקורות עיקריים:** תלמוד בבלי, מסכת נידה, דף סג ע\"ב; שולחן ערוך, יורה דעה, סימן קפ\"ד וסימן קפ\"ט."
      },
      {
        paragraphs: [
          "אכילת מאכלים חריפים מאוד (\"ג'יפ\"), במיוחד אם היא חריגה לאישה או שהמאכל ידוע כבעל השפעה כזו, והראייה הופיעה בסמיכות לאכילה, תיחשב בדרך כלל כ\"אונס\" או \"דבר המרגיל לראות\". כתוצאה מכך, הראייה תיתלה באכילה ולא תיחשב כווסת הגוף, ולכן לא תקבע וסת רגיל. אם הדבר חוזר על עצמו באופן קבוע לאחר אכילת אותו מאכל, הוא עשוי להיחשב כ\"וסת התלוי בדבר\". בכל מקרה של ספק, יש להיוועץ ברב פוסק."
        ],
        sources: "*   **מקורות עיקריים:** תלמוד בבלי, מסכת נידה, דף סג ע\"ב; שולחן ערוך, יורה דעה, סימן קפ\"ט, סעיפים י\"ג ו-ט\"ו; דרכי טהרה, פרק ה', סעיף י\"א."
      }
    ]
  },
  "פתיחת הקבר עם או בלי דם –": {
    subAnswers: [
      {
        paragraphs: [
          "בתלמוד (מסכת נידה כ\"א ע\"ב – כ\"ב ע\"א) קיימת מחלוקת אמוראים בשאלה האם פתיחת הקבר ללא דם מטמאת. רב ורבי יוחנן סוברים שהיא טהורה, בעוד שמואל וריש לקיש סוברים שהיא טמאה, מחשש לדם שלא הורגש או מהנחה שאין פתיחה ללא דם כלשהו."
        ],
        sources: "*   **מקורות:** ויקרא ט\"ו, י\"ט; תלמוד בבלי, מסכת נידה, דפים כ\"א ע\"ב – כ\"ב ע\"א."
      },
      {
        paragraphs: [
          "הראשונים נחלקו כיצד לפסוק במחלוקת האמוראים. הרי\"ף, הרמב\"ם, והרשב\"א פסקו להקל שפתיחת הקבר בלא דם טהורה. לעומתם, הראב\"ד ורבנו תם (כפי שמובא בטור) החמירו. השולחן ערוך פסק להקל, אך הרמ\"א ציין שהמנהג הרווח הוא להחמיר, וכן נוהגים להלכה בדרך כלל."
        ],
        sources: "*   **מקורות:** רי\"ף (נידה דף ט' ע\"א בדפי הרי\"ף); רמב\"ם (משנה תורה, הלכות איסורי ביאה, פרק ה', הלכה י\"ח); רא\"ש (נידה, פרק ג', סימן ב'); שו\"ת הרשב\"א (ח\"א סימן קכ\"ז); השגות הראב\"ד על הרמב\"ם (שם); שולחן ערוך (יורה דעה, סימן קפ\"ח, סעיף א'); הגהות הרמ\"א (שם); ש\"ך וט\"ז (שם)."
      },
      {
        paragraphs: [
          "יש הבדל בין פתיחת הקבר \"מבפנים\" (טבעית) לבין פתיחה \"מבחוץ\" (על ידי גורם חיצוני). הדיון המקורי בתלמוד עוסק בעיקר בפתיחה טבעית. בפתיחה על ידי מכשיר רפואי, אם המכשיר רק מרחיב את הנרתיק ולא פותח את צוואר הרחם, והאישה לא ראתה דם, היא טהורה. אם המכשיר פותח את צוואר הרחם, יש מקום להחמיר כפי המנהג בפתיחת הקבר הטבעית (שפתיחת הקבר בלא דם טמאה), מחשש לדם שלא הורגש. עם זאת, כל מקרה נדון לגופו ויש להתייעץ עם פוסק הלכה."
        ],
        sources: "*   **מקורות:** שולחן ערוך (יורה דעה, סימן קפ\"ח, סעיף א'); שו\"ת ציץ אליעזר (ח\"ה סי' כ\"ד); שו\"ת יביע אומר (ח\"ב יו\"ד סי' י\"ב). אתרים רלוונטיים: מכון פוע\"ה, מרכז נשמת."
      }
    ]
  },
  "מהו דם צדדים, והאם יש לישב עליו ז' נקיים?": {
    subAnswers: [
      {
        paragraphs: [
          "דם צדדים הוא דם שאינו יוצא ממקור דם הווסת (הרחם), אלא מדפנות הנרתיק או ממקום אחר שאינו קשור למחזור. דם כזה, אם זוהה בוודאות, אינו מטמא את האישה. הקושי המרכזי הוא באבחון ודאי של מקור הדם.",
          "**האם יש לישב עליו ז' נקיים?**",
          "\nאם נקבע בוודאות גמורה על ידי גורם מוסמך (רב פוסק, לעיתים בסיוע רופא או בודקת טהרה) שהדם הנראה הוא \"דם צדדים\" ואינו מן המקור, האישה נשארת בטהרתה ואינה צריכה לספור שבעה נקיים. במקרה של ספק, יש להחמיר ולספור שבעה נקיים.",
          "לסיכום:\n\"דם צדדים\" הוא דם שאינו נובע מהרחם אלא מדפנות הנרתיק או ממקור אחר שאינו קשור למחזור הווסת. על פי ההלכה, דם כזה אינו מטמא את האישה. כתוצאה מכך, אם נקבע בוודאות שמדובר בדם צדדים, האישה נשארת טהורה ואינה צריכה לספור שבעה נקיים. עם זאת, הקביעה שמדובר בדם צדדים היא מורכבת ולרוב דורשת בירור הלכתי, ולעיתים גם רפואי. במקרה של ספק, יש להחמיר. חשוב מאוד להתייעץ עם רב פוסק בכל שאלה בנושא."
        ],
        sources: "*   **מקורות שהוזכרו בתשובה:**\n*   **תנ\"ך:** ויקרא, פרק ט\"ו (פסוקים י\"ט, כ\"ה, כ\"ח).\n*   **תלמוד:** תלמוד בבלי, מסכת נידה, דף נ\"ז, עמוד ב'.\n*   **ראשונים:** רש\"י על נידה נ\"ז ע\"ב; רמב\"ם, הלכות איסורי ביאה, פרק ה', הלכה ו'; רא\"ש, הלכות נידה, פרק ד', סימן א'; טור, יורה דעה, סימן קפ\"ג.\n*   **שולחן ערוך ונושאי כליו:** שולחן ערוך, יורה דעה, סימן קפ\"ג, סעיף א'; שולחן ערוך, יורה דעה, סימן קצ\"ו.\n*   **מקורות נוספים (כללי):** מכון פוע\"ה, אתר הידברות, אתר ישיבה (כדוגמאות למקומות בהם ניתן למצוא מידע נוסף, אך לא כמקור פסיקה ישיר)."
      }
    ]
  },
  "הסבר מהו \"לול\" ומה \"עליה\", ומה נאמר על כך בגמ' (הדעות השונות)?": {
    subAnswers: [
      {
        paragraphs: [
          "\"עליה\" היא קומה עליונה בבית, ו\"לול\" הוא פתח או חלל המחבר בין הבית לעליה, המשמש בעיקר להעברת חפצים.",
          "הגמרא במסכת נידה דנה האם לול פתוח הופך את הבית והעלייה ל\"בית אחד\" או שהם נשארים \"שני בתים\" לעניין הרחקות נידה. להלכה נפסק כדעת רב, שהם נחשבים \"שני בתים\" ומותר לאיש להיות באחד מהם ולאשתו בשני גם כשהלול פתוח. ישנה דעת מחמירים (שהובאה ברמ\"א) במקרה שיש סולם קבוע בלול, אך גם אז המקילים לא הפסידו."
        ],
        sources: "*   תלמוד בבלי, מסכת נידה, דף ט\"ז עמוד ב' – דף י\"ז עמוד א'.\n*   רא\"ש, מסכת נידה, פרק ב', סימן ו'.\n*   טור, יורה דעה, סימן קצ\"ה.\n*   שולחן ערוך, יורה דעה, סימן קצ\"ה, סעיף ד'.\n*   רמ\"א על שולחן ערוך, יורה דעה, סימן קצ\"ה, סעיף ד'.\n*   ש\"ך על שולחן ערוך, יורה דעה, סימן קצ\"ה, ס\"ק י\"א.\n*   ט\"ז על שולחן ערוך, יורה דעה, סימן קצ\"ה, ס\"ק ו'."
      }
    ]
  },
  "האם \"הרגשה\" סימן או סיבה לטומאה- מהן הדעות בראשונים ובאחרונים?": {
    subAnswers: [
      {
        paragraphs: [
          "השאלה האם \"הרגשה\" היא סימן או סיבה לטומאה היא שאלה עם ניואנסים.",
          "לפי **הרמב\"ם** ופשטות פסיקת **השולחן ערוך**, ההרגשה היא בעיקר **סימן** הכרחי לכך שהדם הנראה הוא דם נידות מהמקור.",
          "לפי **הרשב\"א**, ההרגשה היא יותר מסימן; היא \"עוקרת דם\", כלומר יש לה תפקיד פעיל בתהליך יציאת הדם, ולכן היא יכולה להיחשב כמעין **סיבה** או התחלה של תהליך הטומאה, מה שמחמיר במצבי ספק (כגון \"הרגישה ולא ראתה מיד\").",
          "האחרונים (כמו הש\"ך וערוך השולחן) מנסים ליישב את הדברים ולהסביר שההרגשה היא סימן מובהק שדם נעקר, ולכן יש לחשוש ליציאתו גם אם לא נראה מיד.",
          "להלכה, הרגשה היא תנאי לטומאת דם נראה, והיא גם יוצרת חשש טומאה במקרה של אי-בדיקה מיידית. הרגשה ללא כל דם או חשש דם אינה מטמאת בפני עצמה.",
          "הדיון אם היא \"סימן\" או \"סיבה\" מסייע להבין את עומק ההלכה והשלכותיה במצבים שונים, אך ההלכה הפסוקה בשולחן ערוך היא הקובעת למעשה. בכל מקרה של ספק, יש כמובן להיוועץ ברב פוסק."
        ],
        sources: "*   תנ\"ך: ויקרא טו, יט.\n*   תלמוד: מסכת נידה דף נז עמוד ב; דף יז עמוד ב.\n*   ראשונים: רמב\"ם (הלכות איסורי ביאה, פרק ה, הלכה יח); ראב\"ד (השגות על הרמב\"ם שם); רשב\"א (תורת הבית, בית ז, שער א); רא\"ש (נידה, פרק ט, סימן א).\n*   שולחן ערוך: יורה דעה, סימן קפג, סעיף א.\n*   אחרונים: בית יוסף (יורה דעה, סימן קפג); ש\"ך (יורה דעה, סימן קפג, ס\"ק א); ט\"ז (יורה דעה, סימן קפג, ס\"ק א); ערוך השולחן (יורה דעה, סימן קפג, סעיפים ג-ה).\n*   מקורות מודרניים (דוגמאות): ספר \"טהרת הבית\"; אתר \"דעת\" (www.daat.ac.il  )."
      }
    ]
  },
  "חיבוק ונישוק סמוך לוסת – מותר או אסור. ואם אסור- האם מהתורה או מדרבנן?": {
    subAnswers: [
      {
        paragraphs: [
          "סמוך לווסת, בעונה שבה האישה צריכה לפרוש מבעלה (עונת הפרישה), אסורים חיבוק ונישוק, וכן שאר ההרחקות הנוהגות בזמן שהאישה נידה. זאת על פי הדעה המקובלת להלכה (הש\\\"ך והב\\\"ח). איסור זה של חיבוק ונישוק בעונת הפרישה סמוך לווסת הוא **מדרבנן**, מכיוון שכל דין הפרישה סמוך לווסת הוא תקנת חכמים."
        ],
        sources: "*   תנ\\\"ך: ויקרא יח, יט.\\\\\\n*   תלמוד בבלי: מסכת נדה, דף סג עמוד ב.\\\\\\n*   רמב\\\"ם: הלכות איסורי ביאה, פרק כא, הלכה א.\\\\\\n*   שולחן ערוך: יורה דעה, סימן קפד, סעיף א; יורה דעה, סימן קצה, סעיפים א-ב; אבן העזר, סימן כ, סעיף א.\\\\\\n*   נושאי כלים על השולחן ערוך: ט\\\"ז (רבי דוד הלוי סגל) על יורה דעה, סימן קפד, ס\\\"ק א; ש\\\"ך (רבי שבתי כהן) על יורה דעה, סימן קפד, ס\\\"ק ב (בשם הב\\\"ח).\\\\\\\\n*   ספרי הלכה מודרניים: \\\"טהרת הבית\\\" (הרב עובדיה יוסף); \\\"פניני הלכה – טהרת המשפחה\\\" (הרב אליעזר מלמד)."
      }
    ]
  },
  "מהו המקור לכך שבלנית צריכה להיות נוכחת בשעת הטבילה? והאם זה מעכב?": {
    subAnswers: [
      {
        paragraphs: [
          "המקור לצורך בנוכחות אשה אחרת (בלנית) בשעת הטבילה הוא בגמרא (נידה סו ע\"ב), והוא נפסק להלכה בשולחן ערוך (יורה דעה קצח, מ). נוכחות הבלנית נדרשת לכתחילה כדי לוודא שהטבילה נעשית כהלכה, ובפרט שלא יהיו חציצות (כגון שערות צפות). עם זאת, בדיעבד, אם אשה טבלה כהלכה ללא נוכחות בלנית, טבילתה כשרה ואינה מעוכבת. המנהג הרווח הוא להקפיד על נוכחות בלנית."
        ],
        sources: "*   תלמוד בבלי, מסכת נידה, דף סו, עמוד ב.\\\\n*   רמב\\\"ם, משנה תורה, הלכות איסורי ביאה, פרק יא, הלכה טז.\\\\n*   רא\\\"ש, פסקי הרא\\\"ש, מסכת נידה, פרק י, סימן ג.\\\\n*   שולחן ערוך, יורה דעה, סימן קצח, סעיף מ.\\\\n*   רמ\\\"א, הגהות על שולחן ערוך, יורה דעה, סימן קצח, סעיף מ.\\\\n*   ש\\\"ך, יורה דעה, סימן קצח, ס\\\"ק סא.\\\\n*   ט\\\"ז, יורה דעה, סימן קצח, ס\\\"ק כט.\\\\n*   ערוך השולחן, יורה דעה, סימן קצח, סעיף פו.\\\\n*   ויקרא, פרק טו, פסוקים יג, טז."
      }
    ]
  },
  "רודמ\"ת משום חולי או משום וסת, ומה הנפקא מינה? (הבא לפחות ג\' נ\"מ)?": {
    subAnswers: [
      {
        paragraphs: [
          "ההלכה מבחינה בין רואה דם מחמת תשמיש (רודמ\\\"ת) שדינה כווסת, לבין מקרה שבו תולים את הדם בתשמיש עצמו כגורם חיצוני (כעין חולי או פציעה). ההבחנה תלויה בעיקר במצבה של האישה (האם דרכה לראות וסת באופן סדיר) ובתדירות הופעת הדם. אם ידוע על מכה או סיבה רפואית, יש מקום לתלות בכך.",
          "הנפקא מינות העיקריות הן:",
          "1.  **קביעת וסת:** האם הראייה קובעת וסת רגיל, וסת לתשמיש, או שאינה קובעת וסת כלל.",
          "2.  **חובת פרישה בעונת הווסת:** האם יש חובת פרישה בעונה המתאימה.",
          "3.  **צורך בבדיקה לפני ואחרי תשמיש:** האם יש חובה לבדוק לפני ואחרי תשמיש."
        ],
        sources: "*   תנ\\\"ך: ויקרא ט\\\"ו, יט.\\\\n*   תלמוד: מסכת נידה, דפים סה ע\\\"ב - סו ע\\\"א.\\\\n*   שולחן ערוך: יורה דעה, סימן קפ\\\"ז, סעיף ג\\\".\\\\n*   נושאי כלים: ש\\\"ך על יורה דעה, סימן קפ\\\"ז, ס\\\"ק יא (בשם הרשב\\\"א).\\\\n*   מקורות מודרניים (דוגמאות): מכון פוע\\\"ה, אתר דעת, ספרי \\\"טהרת הבית\\\" ו\\\"שערי טהרה\\\"."
      }
    ]
  },
  "רודמ\"ת- האם ראיה ראשונה מן המנין, מהן הדעות, וכיצד נפסק להלכה?": {
    subAnswers: [
      {
        paragraphs: [
          "ההלכה הפסוקה היא שיום ראיית הדם הראשון (וכל יום שיש בו דימום) אינו נמנה כלל כחלק משבעת הימים הנקיים. ספירת שבעת הימים הנקיים מתחילה רק לאחר שהאישה ביצעה \"הפסק טהרה\" (בדיקה המוכיחה שהדימום פסק לחלוטין), וגם יום ההפסק עצמו אינו עולה למניין. הספירה מתחילה מהיום שלמחרת יום ההפסק. אין מחלוקת משמעותית על כך בפסיקה המקובלת."
        ],
        sources: "*   תנ\"ך: ויקרא ט\"ו, י\"ט; ויקרא ט\"ו, כ\"ח.\\\\n*   תלמוד: מסכת נידה, דף ס\"ט, עמוד א\\\".\\\\n*   רמב\"ם: הלכות איסורי ביאה, פרק ו\\\", הלכה ה\\\".\\\\n*   שולחן ערוך: יורה דעה, סימן קצ\"ו, סעיף א\\\"."
      }
    ]
  },
  "א. מהו המקור שממנו נלמד טבילה לנדה? ב. האם טבילת נדה מהתורה או מדרבנן?": {
    subAnswers: [
      {
        paragraphs: [
          "המקור לטבילת נידה הוא מהתורה, בספר ויקרא, פרק ט\"ו. הפסוקים שם מתארים את טומאת הנידה והזבה, ואת תהליך הטהרה הכולל ספירת ימים ורחיצה במים, שהיא הטבילה במקווה. דין זה מפורש בהרחבה בתלמוד ונפסק להלכה ברמב\"ם ובשולחן ערוך."
        ],
        sources: "*   תנ\"ך: ויקרא ט\"ו, י\"ג; ויקרא ט\"ו, י\"ט; ויקרא ט\"ו, כ\"ח.\\\\n*   תלמוד: מסכת נידה (למשל דף ס\"ו ע\"ב - ס\"ז ע\"א).\\\\n*   רמב\"ם: משנה תורה, הלכות איסורי ביאה, פרק ד\", הלכה ג\".\\\\n*   שולחן ערוך: יורה דעה, סימן קפ\"ג, סעיף א\"; יורה דעה, סימן קצ\"ז, סעיף א\"."
      },
      {
        paragraphs: [
          "**לסיכום:**",
          "טבילת נידה היא חיוב גמור מהתורה (מדאורייתא). התורה מצווה על האישה הנידה להיטהר באמצעות טבילה במקווה לאחר סיום ימי נידתה וספירת שבעה ימים נקיים (כפי שנהוג היום על פי תקנת חכמים להחמיר על כל רואה דם לספור שבעה נקיים). בעוד שפרטים מסוימים בהכנות לטבילה או חומרות מסוימות עשויים להיות מדרבנן, עצם החיוב לטבול כדי להיטהר ולהיות מותרת לבעלה הוא ציווי מפורש מהתורה."
        ],
        sources: "*   תנ\"ך: ויקרא ט\"ו, י\"ג; ויקרא ט\"ו, כ\"ח.\\\\n*   רמב\"ם: ספר המצוות, מצוות עשה ק\"ט; משנה תורה, הלכות מקוואות, פרק א\", הלכה א\".\\\\n*   שולחן ערוך: יורה דעה, סימן קפ\"ג, סעיף א\"."
      }
    ]
  },
  "מה הדין בראיית דמים": {
    subAnswers: [
      {
        paragraphs: [
          "אשה שראתה דם בלילה, בין אם הרגישה ובין אם לא הרגישה, נטמאת משעת הראייה עצמה ולא למפרע."
        ],
        sources: "*   תורה: ויקרא טו, יט.\\\\n*   תלמוד: מסכת נידה, דף יא, עמוד א.\\\\n*   שולחן ערוך: יורה דעה, סימן קצ, סעיף א."
      },
      {
        paragraphs: [
          "אין לסמוך על בדיקת דם הנעשית לאור הכוכבים בלבד, מכיוון שאור זה אינו מספיק להבחנה מדויקת של צבע המראה. יש לבדוק באור טוב יותר. אם ראתה מראה חשוד לאור הכוכבים ואינה יכולה לבדוק שוב מיד, יש להחמיר."
        ],
        sources: "*   תלמוד: מסכת נידה, דף יא, עמוד א.\\\\n*   שולחן ערוך: יורה דעה, סימן קצ, סעיף ג."
      }
    ]
  },
  "טבילה וחציצה": {
    subAnswers: [
      {
        paragraphs: [
          "אין חובה הלכתית על אישה לגלח את שערה (לא שיער הראש ולא שיער הגוף) לפני הטבילה. החובה המרכזית היא לוודא שכל השיער נקי, סרוק היטב, ללא קשרים, ושהמים יכולים להגיע לכל מקום בגוף ובשיער ללא הפרעה. יש נשים הנוהגות להסיר שיער גוף מטעמי נוחות, אסתטיקה או למניעת חשש חציצה, אך אין זו חובה גורפת."
        ],
        sources: "*   ויקרא יד, ט; תלמוד בבלי, מסכת נידה, דף סו ע\"ב; שולחן ערוך, יורה דעה, סימן קצח, סעיפים כ, כד; ט\"ז, יורה דעה, סימן קצח, ס\"ק כ."
      },
      {
        paragraphs: [
          "אי גילוח שיער כשלעצמו אינו מעכב את הטבילה ואינו מצריך טבילה חוזרת. הטבילה תיפסל רק אם בשיער שלא גולח נשאר דבר החוצץ (כגון קשר אמיץ, לכלוך שהיא מקפידה עליו) שמנע מהמים להגיע כראוי. במקרה שהתגלה ספק חציצה לאחר הטבילה, יש להתייעץ עם רב, וייתכן שיהיה צורך לחזור ולטבול."
        ],
        sources: "*   תלמוד בבלי, מסכת נידה, דף סו ע\"ב; שולחן ערוך, יורה דעה, סימן קצח, סעיפים א, כ."
      }
    ]
  }
};

interface QAPair {
  type: 'question'; // Added to distinguish from section headers
  questionNumber: string;
  questionHeader: string;
  questionBodyLines: string[];
  questions: string[];
}

interface SectionHeaderItem {
  type: 'sectionHeader';
  id: string;
  text: string;
}

type TestDisplayItem = QAPair | SectionHeaderItem;

function parseTestContent(content: string): { intro: string[]; testDisplayItems: TestDisplayItem[] } {
  console.log("Starting parseTestContent (interleaved sections)");

  const productionMainQuestionRegex = /^\s*(\d+)\)\s*(.+)/; 
  const subQuestionRegex = /^([א-ת])\.\s*(.+)/; 

  const lines = content.split('\n');
  const intro: string[] = []; // For content before the first '## section' or first question
  const testDisplayItems: TestDisplayItem[] = [];
  let currentQA: QAPair | null = null;
  let parsingMainContent = false; // Becomes true after first '## Section' or first question.

  for (let i = 0; i < lines.length; i++) {
    const line = lines[i].trim();

    if (!line) { // Skip empty lines
        if (currentQA && parsingMainContent) { // Push pending QA if we are in main content area
            testDisplayItems.push(currentQA);
            currentQA = null;
        }
        continue;
    }

    if (line.startsWith("## ")) {
        if (!parsingMainContent && intro.length > 0 && !testDisplayItems.find(item => item.type === 'sectionHeader' && item.text.startsWith("## "))) {
            // This is the first "## section" header encountered after some initial intro.
            // The intro array is complete. Any subsequent "##" are part of testDisplayItems.
        }
        parsingMainContent = true;
        if (currentQA) {
            testDisplayItems.push(currentQA);
            currentQA = null;
        }
        // Check if it's a ## Title that should be in intro (like main test title) vs section separator
        if (line.startsWith("## עיון") || line.startsWith("## בקיאות") || testDisplayItems.length > 0 ) { // if already parsing Qs or it's a known section
             testDisplayItems.push({ type: 'sectionHeader', id: `section-${i}`, text: line });
        } else {
            intro.push(line); //Likely a main title like "## מבחן בהלכות נידה"
        }
        continue;
    }
    
    // Lines like #, ###, ---, or general text before first proper section or QAPair
    if (!parsingMainContent && !productionMainQuestionRegex.test(line)) {
        if (line.startsWith("# ") || line.startsWith("### ") || line === "---" || line.startsWith("כ\"ח אדר") || line.startsWith("THE CHIEF RABBINATE")) {
            intro.push(line);
            continue;
        }
    }


    const isMainQ = productionMainQuestionRegex.test(line);

    if (isMainQ) {
        parsingMainContent = true; // A question marks the start of main content
        if (currentQA) {
            testDisplayItems.push(currentQA);
        }
        const questionHeaderMatch = line.match(productionMainQuestionRegex)!;
        const questionNumber = questionHeaderMatch[1];
        const questionText = questionHeaderMatch[2].trim();
        currentQA = { type: 'question', questionNumber: questionNumber, questionHeader: questionText, questionBodyLines: [], questions: [] };
    } else if (subQuestionRegex.test(line) && currentQA) {
        currentQA.questions.push(line);
    } else if (currentQA) { // Line belongs to current main question body
        currentQA.questionBodyLines.push(line);
    } else if (parsingMainContent) { 
        // If parsing main content but it's not a Q, SubQ, or ## Section, it's likely an orphaned line.
        // For now, let's assume it's a paragraph that should be part of a section.
        // To handle this better, we might need a way to group these under the last section header.
        // Or, treat them as general paragraphs within testDisplayItems.
        // For simplicity now, we'll add it as a sectionHeader, which renderMarkdownStyle can handle as a plain p if not ##
        // This assumes such lines are rare or should be styled like intro paragraphs.
        // Consider adding a new type like 'paragraph' to TestDisplayItem for better distinction.
         testDisplayItems.push({ type: 'sectionHeader', id: `paragraph-${i}`, text: line });
    } else {
        // Default: line is part of the initial intro block
        if (line || intro.length > 0 ) intro.push(line);
    }
  }

  if (currentQA) {
    testDisplayItems.push(currentQA);
  }

  console.log("ParseTestContent Finished. Intro lines: " + intro.length + ", TestDisplayItems: " + testDisplayItems.length);
  if (testDisplayItems.some(item => item.type === 'question')) {
    const firstQ = testDisplayItems.find(item => item.type === 'question') as QAPair | undefined;
    if (firstQ) {
        console.log("First Q parsed: Header='", firstQ.questionHeader, "' BodyLines=", firstQ.questionBodyLines.length, "SubQs=", firstQ.questions.length);
    }
  }
  return { intro, testDisplayItems };
}

export default function TestNidaPage() {
  const router = useRouter();
  const { intro, testDisplayItems } = parseTestContent(testContent);
  const [openStates, setOpenStates] = React.useState<Record<string, boolean>>({});

  React.useEffect(() => {
    console.log("TestNidaPage data (testDisplayItems):", testDisplayItems);
  }, [testDisplayItems]);

  const toggleAnswer = (key: string) => {
    setOpenStates(prev => ({ ...prev, [key]: !prev[key] }));
  };

  const renderMarkdownStyle = (text: string, key?: string) => {
    // Ensure key is passed for list items if this function is used in a map for non-TestDisplayItems
    if (text.startsWith('#### ')) return <h4 key={key} className="text-sm font-semibold mt-1 mb-1 text-center text-[var(--primary-muted)]">{text.substring(5)}</h4>;
    if (text.startsWith('### ')) return <h3 key={key} className="text-md font-bold mt-1 mb-1 text-center text-[var(--primary-muted)]">{text.substring(4)}</h3>;
    if (text.startsWith('## ')) {
      if (text.includes("מבחן בהלכות נידה")) {
        return <h2 key={key} className="text-m font-semibold mt-1 mb-2 text-center text-[var(--primary-muted)]">{text.substring(3)}</h2>;
      }
      if (text === "## THE CHIEF RABBINATE OF ISRAEL") {
         return <h2 key={key} className="text-lg font-bold mt-2 mb-2 text-center text-[var(--primary)] dir-ltr">{text.substring(3)}</h2>;
      }
      // For other ## headers like עיון, בקיאות
      return <h2 key={key} className="text-lg font-bold mt-4 mb-3 text-center text-[var(--primary)] border-t-2 border-[var(--primary-muted)] pt-3">{text.substring(3)}</h2>;
    }
    if (text.startsWith('# ')) return <h1 key={key} className="text-xl font-bold mt-2 mb-3 text-center text-[var(--primary)]">{text.substring(2)}</h1>;
    if (text.startsWith('**') && text.endsWith('**')) return <p key={key} className="text-center font-bold my-3 text-[var(--foreground)]">{text.substring(2, text.length - 2)}</p>;
    if (text.startsWith('---')) return <hr key={key} className="my-4 border-[var(--primary-muted)]" />;
    
    if (text.trim() === 'בס"ד') return <p key={key} className="text-xs text-right font-medium text-[var(--primary-muted)]">{text}</p>;
    // Default paragraph
    return <p key={key} className="my-1 text-sm text-right text-[var(--foreground)] dir-rtl">{text}</p>;
  };

  return (
    <div className="min-h-screen bg-[var(--background)] text-[var(--foreground)] dark:bg-[var(--background)] dark:text-[var(--foreground)] flex flex-col">
      <header className="p-4 bg-[var(--primary)] text-[var(--background)]">
        <div className="container mx-auto flex justify-between items-center">
          <div className="text-sm flex-shrink-0">
            בס&quot;ד
          </div>
          <div className="flex-grow text-center px-4">
            <h1 className="text-2xl sm:text-3xl font-bold">מבחן בהלכות נידה</h1>
            <p className="mt-1 text-xs sm:text-sm">פלטפורמה זו עומדת במבחני הרבנות</p>
          </div>
          <div className="flex-shrink-0">
            <button
              onClick={() => router.push("/qualified")}
              className="px-2.5 py-1 bg-slate-200 text-[var(--primary)] rounded-md hover:bg-slate-300/80 transition-colors font-medium text-xs shadow-sm"
            >
              חזרה למבחנים
            </button>
          </div>
        </div>
      </header>

      <main className="flex-1 container mx-auto p-4 max-w-3xl">
        <div className="mb-6 text-center text-sm text-[var(--foreground)] dir-rtl">
          <p className="font-semibold text-md">מבחן הסמכה רשמי לשנת תשס&quot;ט</p>
          <p className="mt-1">מקור: ארכיון מבחני הסמכה של הרבנות הראשית לישראל</p>
          <p><a href="https://www.smicha.co.il/mivchanim.php?it=6&cat=16" target="_blank" rel="noopener noreferrer" className="text-[var(--primary)] hover:underline">https://www.smicha.co.il/mivchanim.php?it=6&cat=16</a></p>
          <p className="mt-2">מסמך מקור: <a href="https://www.smicha.co.il/gallery/mivchanim-28.pdf" target="_blank" rel="noopener noreferrer" className="text-[var(--primary)] hover:underline">https://www.smicha.co.il/gallery/mivchanim-28.pdf</a></p>
        </div>

        <div 
          className="bg-yellow-50 dark:bg-yellow-700 p-6 rounded-lg shadow-xl mb-6"
          style={{ backgroundImage: "url('/scroll_texture.png')", backgroundSize: 'cover' }}
        >
          {intro.map((line, index) => (
            <div key={`intro-${index}`} dir={line.startsWith('## THE CHIEF RABBINATE') || line.startsWith("Beit Yahav") || line.startsWith("כ\"ח אדר") ? 'ltr' : 'rtl'}>
              {renderMarkdownStyle(line, `intro-line-${index}`)}
            </div>
          ))}

          {testDisplayItems.length > 0 && (
            <div className="space-y-2 my-4"> {/* Reduced space-y for tighter packing */}
              {testDisplayItems.map((item, index) => {
                const itemKey = `display-item-${index}`; // Use the map index for a guaranteed unique key

                if (item.type === 'sectionHeader') {
                  return renderMarkdownStyle(item.text, itemKey);
                }
                
                // Item is QAPair
                const qa = item as QAPair;
                const mainQuestionToggleKey = `main-q-${qa.questionNumber}`;
                const isMainQuestionOpen = !!openStates[mainQuestionToggleKey];
                
                const answerMapKey = qa.questionHeader.trim().replace(/:$/, "");
                const mainAnswerDataAttempt = answersMap[answerMapKey];
                const mainAnswerData = mainAnswerDataAttempt?.subAnswers[0];

                if (qa.questionNumber === "1") { // Debug for Q1 specifically
                    console.log(`[Render Q1] answerMapKey: "${answerMapKey}"`);
                    console.log(`[Render Q1] answersMap has key: ${answersMap.hasOwnProperty(answerMapKey)}`);
                    console.log(`[Render Q1] mainAnswerDataAttempt: ${JSON.stringify(mainAnswerDataAttempt?.subAnswers[0])}`);
                }

                return (
                <div 
                  key={itemKey} 
                  className="p-3 rounded-lg mb-3" // Reduced padding/margin
                >
                  <div 
                    className={`cursor-pointer ${qa.questions.length === 0 ? 'group' : ''}`} 
                    onClick={() => {
                        if (qa.questions.length === 0) {
                            toggleAnswer(mainQuestionToggleKey);
                        }
                    }}
                  >
                    <h3 
                      className="text-lg font-semibold mb-1 text-right text-[var(--primary)] border-b-2 border-[var(--primary-muted)] pb-2 dir-rtl flex justify-between items-center"
                    >
                      <span dangerouslySetInnerHTML={{ __html: `${qa.questionNumber}) ${qa.questionHeader}`.replace(/`(.*?)`/g, '<code class="bg-gray-200 dark:bg-gray-700 px-1 rounded text-sm">$1</code>') }} />
                      {qa.questions.length === 0 && (
                         <span 
                           className="text-lg ml-2 transform transition-transform duration-200 text-red-500"
                         >
                           {isMainQuestionOpen ? '▼' : '▶'}
                         </span>
                      )}
                    </h3>
                    {qa.questionBodyLines.length > 0 && (
                       <div className="text-sm text-right my-1 text-[var(--foreground)] dir-rtl pl-4 mb-2">
                         {qa.questionBodyLines.map((bodyLine, bIdx) => (
                           <p key={`qbody-${index}-${bIdx}`}>{bodyLine}</p>
                         ))}
                       </div>
                    )}
                  </div>

                  {qa.questions.length === 0 ? ( // Main question, potentially with answer
                    mainAnswerData ? (
                      <div 
                        className={`transition-all duration-300 ease-in-out overflow-hidden ${isMainQuestionOpen ? 'max-h-[1000px] opacity-100 mt-2' : 'max-h-0 opacity-0'}`} // Tailwind transition
                      >
                        <div className="mt-2 ml-4 pl-4 pr-2 pb-2 border-l-2 border-blue-500 py-2">
                          <div style={{ backgroundColor: 'lightyellow', padding: '10px', border: '1px solid orange' }}>
                            {mainAnswerData.paragraphs.map((p: string, pIdx: number) => (
                              <p 
                                key={`main-ans-p-${index}-${pIdx}`} 
                                className="text-lg mb-1 dir-rtl"
                                style={{ color: 'black' }}
                                dangerouslySetInnerHTML={{ __html: p.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\\n|\n/g, '<br />') }} 
                              />
                            ))}
                            {mainAnswerData.sources && (
                              <p 
                                className="text-sm italic mt-3 dir-rtl"
                                style={{ color: '#555' }}
                              >
                                <strong>מקורות עיקריים:</strong> <span dangerouslySetInnerHTML={{ __html: mainAnswerData.sources.replace(/\\n|\n/g, '<br />') }} />
                              </p>
                            )}
                          </div>
                        </div>
                      </div>
                    ) : (
                      <div 
                        className={`transition-all duration-300 ease-in-out overflow-hidden ${isMainQuestionOpen ? 'max-h-[1000px] opacity-100 mt-2' : 'max-h-0 opacity-0'}`} // Tailwind transition
                      >
                        <div 
                          className="text-xs italic dir-rtl p-2 bg-gray-100 dark:bg-gray-800 rounded mt-2 ml-4"
                          style={{ color: 'red' }}
                        >
                          (עדיין אין תשובה זמינה עבור שאלה זו)
                        </div>
                      </div>
                    )
                  ) : ( // Question with sub-questions
                    <div className="space-y-2 pl-4 text-right dir-rtl mt-2">
                      {qa.questions.map((q, qIndex) => {
                        const subQuestionUniqueKey = `ans-${qa.questionNumber}-${qIndex}`;
                        const answerData = answersMap[answerMapKey]?.subAnswers[qIndex];
                        
                        return (
                          <div 
                            key={`q-${index}-${qIndex}`} 
                            className="text-sm text-[var(--foreground)] mb-2 p-1 border-b border-gray-300 dark:border-gray-700"
                          >
                            <div 
                              className="flex justify-between items-center cursor-pointer py-2 pr-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
                              onClick={() => toggleAnswer(subQuestionUniqueKey)}
                            >
                              <p className="font-medium flex-grow dir-rtl">{q}</p>
                              <span 
                                className="text-lg ml-2 transform transition-transform duration-200 text-red-500"
                              >
                                {openStates[subQuestionUniqueKey] ? '▼' : '▶'}
                              </span>
                            </div>
                            {openStates[subQuestionUniqueKey] && (
                              <div 
                                className="answer-container mt-2 ml-4 pl-4 pr-2 pb-2 border-l-2 border-blue-500 py-2"
                              >
                                {answerData ? (
                                  <div style={{ backgroundColor: 'lightyellow', padding: '10px', border: '1px solid orange' }}>
                                    {answerData.paragraphs.map((p: string, pIdx: number) => (
                                      <p 
                                        key={`ans-p-${index}-${qIndex}-${pIdx}`} 
                                        className="text-lg mb-1 dir-rtl"
                                        style={{ color: 'black' }}
                                        dangerouslySetInnerHTML={{ __html: p.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\\n|\n/g, '<br />') }} 
                                      />
                                    ))}
                                    {answerData.sources && (
                                      <p 
                                        className="text-sm italic mt-3 dir-rtl"
                                        style={{ color: '#555' }}
                                      >
                                        <strong>מקורות עיקריים:</strong> <span dangerouslySetInnerHTML={{ __html: answerData.sources.replace(/\\n|\n/g, '<br />') }} />
                                      </p>
                                    )}
                                  </div>
                                ) : (
                                  <div 
                                    className="text-xs italic dir-rtl p-2 bg-gray-100 dark:bg-gray-800 rounded"
                                    style={{ color: 'red' }}
                                  >
                                    (עדיין אין תשובה זמינה עבור שאלה זו)
                                  </div>
                                )}
                              </div>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  )}
                </div>
                );
              })}
            </div>
          )}
            </div>
      </main>

      <footer className="p-4 bg-[var(--primary-muted)] text-center mt-8">
        <Image src={logo} alt="AskARabbi Logo" className="h-10 mx-auto" width={40} height={40} />
        <p className="text-xs text-[var(--primary-foreground)] opacity-75 mt-1">
            © {new Date().getFullYear()} AskARabbi. כל הזכויות שמורות.
        </p>
      </footer>
    </div>
  );
} 